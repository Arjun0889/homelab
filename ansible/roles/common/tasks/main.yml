---
- name: Set timezone to America/New_York
  community.general.timezone:
    name: America/New_York

- name: Generate en_US.UTF-8 locale
  community.general.locale_gen:
    name: en_US.UTF-8
    state: present

- name: Install common packages
  ansible.builtin.apt:
    name:
      - neovim
      - git
      - python3
      - python3-pip
      - cifs-utils
      - nfs-common
      - open-iscsi
      - zsh
      - stow
      - curl
      - unzip
    state: present
    update_cache: true

- name: Create user arjun
  ansible.builtin.user:
    name: arjun
    password: "{{ user_password }}"
    groups: sudo
    shell: /bin/zsh
    append: true

- name: Add SSH key for arjun
  ansible.posix.authorized_key:
    user: arjun
    state: present
    key: "{{ user_ssh_key }}"

- name: Disable UFW
  community.general.ufw:
    state: disabled

- name: Set ISCSI Initiator Name
  ansible.builtin.copy:
    content: "InitiatorName=iqn.2016-04.com.open-iscsi:{{ inventory_hostname }}\n"
    dest: /etc/iscsi/initiatorname.iscsi
    mode: '0644'
  notify: Restart iscsid

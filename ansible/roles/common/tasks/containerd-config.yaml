---
# Configure containerd logging
- name: Create containerd config directory
  ansible.builtin.file:
    path: /etc/rancher/k3s
    state: directory
    mode: '0755'

- name: Configure containerd log rotation
  ansible.builtin.copy:
    content: |
      [plugins."io.containerd.grpc.v1.cri".containerd]
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
            SystemdCgroup = true
      [plugins."io.containerd.grpc.v1.cri"]
        max_container_log_line_size = 16384
    dest: /etc/rancher/k3s/containerd-config.toml
    mode: '0644'